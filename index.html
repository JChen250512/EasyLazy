<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EazyLazyç·šä¸Šé ç´„</title>
    <style>
        /* --- CSS æ¨£å¼å€ --- */
        :root {
            --primary-color: #d4a373; /* è³ªæ„Ÿå¥¶èŒ¶è‰² */
            --bg-color: #fefae0;      /* æŸ”å’ŒèƒŒæ™¯ */
            --text-color: #4a4a4a;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 500px; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦å„ªåŒ– */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        select, input[type="text"], input[type="tel"], input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’ç ´å¯¬åº¦ */
        }

        /* æœå‹™å¡ç‰‡æ¨£å¼ (æ¨¡æ“¬é¸å–®) */
        .service-info {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            display: none; /* é è¨­éš±è— */
        }

        /* æ™‚æ®µæŒ‰éˆ•å€åŸŸ */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .time-btn {
            padding: 10px;
            border: 1px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        .time-btn.selected {
            background: var(--primary-color);
            color: white;
        }

        .time-btn:disabled {
            background: #eee;
            border-color: #ddd;
            color: #aaa;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* é€å‡ºæŒ‰éˆ• */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .submit-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>EazyLazyç¾ç«é ç´„</h1>
    
    <form id="bookingForm">
        <div class="form-group">
            <label for="service">é¸æ“‡æœå‹™é …ç›®</label>
            <select id="service" required onchange="updateServiceInfo()">
                <option value="" disabled selected>è«‹é¸æ“‡...</option>
                <option value="3d_natural" data-price="1200" data-time="90">3D è‡ªç„¶è£¸å¦æ¬¾ (90åˆ†)</option>
                <option value="6d_volume" data-price="1800" data-time="120">6D è¼•ç›ˆçˆ†æ¿ƒæ¬¾ (120åˆ†)</option>
                <option value="remove" data-price="500" data-time="30">ä»–åº—å¸é™¤ (30åˆ†)</option>
            </select>
            <div id="serviceDetail" class="service-info">
                ğŸ’° åƒ¹æ ¼: <span id="priceDisplay">0</span> å…ƒ | â± æ™‚é–“: <span id="timeDisplay">0</span> åˆ†é˜
            </div>
        </div>

        <div class="form-group">
            <label for="staff">æŒ‡å®šç¾ç«å¸«</label>
            <select id="staff" required>
                <option value="any">ä¸æŒ‡å®š (æœ€å¿«å®‰æ’)</option>
                <option value="peggy">Peggy è€å¸«</option>
                <!--
				<option value="claire">Claire è€å¸«</option>
				-->
            </select>
        </div>

        <div class="form-group">
            <label for="date">é ç´„æ—¥æœŸ</label>
            <input type="date" id="date" required onchange="generateTimeSlots()">
        </div>

        <div class="form-group">
            <label>é¸æ“‡æ™‚æ®µ</label>
            <div id="timeSlotsContainer" class="time-slots">
                <div style="grid-column: 1/-1; color: #888; text-align: center;">è«‹å…ˆé¸æ“‡æ—¥æœŸ</div>
            </div>
            <input type="hidden" id="selectedTime" required>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

        <div class="form-group">
            <label for="name">æ‚¨çš„å§“å</label>
            <input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å" required>
        </div>

        <div class="form-group">
            <label for="phone">è¯çµ¡é›»è©±</label>
            <input type="tel" id="phone" placeholder="09xx-xxx-xxx" required>
        </div>
		
		<div style="display:none;">
			<label for="nickname">è«‹å‹¿å¡«å¯«</label>
			<input type="text" id="nickname" name="nickname">
		</div>

        <button type="submit" class="submit-btn">ç¢ºèªé ç´„</button>
    </form>
</div>

<script>
    // --- JavaScript é‚è¼¯å€ ---

    // 1. æ›´æ–°æœå‹™è³‡è¨Šé¡¯ç¤º
    function updateServiceInfo() {
        const serviceSelect = document.getElementById('service');
        const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
        const detailDiv = document.getElementById('serviceDetail');
        
        if (selectedOption.value) {
            document.getElementById('priceDisplay').innerText = selectedOption.dataset.price;
            document.getElementById('timeDisplay').innerText = selectedOption.dataset.time;
            detailDiv.style.display = 'block';
        }
    }

    // 2. æ¨¡æ“¬ç”¢ç”Ÿæ™‚æ®µ (å¯¦éš›é–‹ç™¼æ™‚ï¼Œé€™è£¡æœƒå‘¼å«å¾Œç«¯ API æª¢æŸ¥æ˜¯å¦æœ‰ç©ºä½)
    function generateTimeSlots() {
        const container = document.getElementById('timeSlotsContainer');
        const dateInput = document.getElementById('date').value;
        container.innerHTML = ''; // æ¸…ç©ºèˆŠæŒ‰éˆ•

        if (!dateInput) return;

        // æ¨¡æ“¬ç‡Ÿæ¥­æ™‚é–“ 10:00 - 18:00
        const startHour = 10;
        const endHour = 18;
        
        // æ¨¡æ“¬ä¸€äº›å·²ç¶“è¢«é ç´„çš„æ™‚æ®µ (ä¾‹å¦‚ 14:00)
        const bookedSlots = ['14:00'];

        for (let i = startHour; i <= endHour; i++) {
            const timeLabel = `${i}:00`;
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'time-btn';
            btn.innerText = timeLabel;

            // æª¢æŸ¥æ˜¯å¦è¢«é ç´„
            if (bookedSlots.includes(timeLabel)) {
                btn.disabled = true;
                btn.title = "å·²é ç´„";
            } else {
                btn.onclick = function() {
                    selectTime(this, timeLabel);
                };
            }
            container.appendChild(btn);
        }
    }

    // 3. è™•ç†æ™‚æ®µé¸æ“‡
    function selectTime(btn, time) {
        // æ¸…é™¤å…¶ä»–æŒ‰éˆ•çš„é¸å–ç‹€æ…‹
        const allBtns = document.querySelectorAll('.time-btn');
        allBtns.forEach(b => b.classList.remove('selected'));
        
        // è¨­å®šç•¶å‰æŒ‰éˆ•
        btn.classList.add('selected');
        document.getElementById('selectedTime').value = time;
    }

// ... å‰é¢çš„ç¨‹å¼ç¢¼ä¿æŒä¸è®Š ...

    // 4. é€å‡ºè¡¨å–® (å·²é€£æ¥ Google Sheet)
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
        e.preventDefault(); // é˜»æ­¢é é¢é è¨­è·³è½‰

        const submitBtn = document.querySelector('.submit-btn');
        
        // ç²å–è³‡æ–™
        const service = document.getElementById('service').options[document.getElementById('service').selectedIndex].text;
        const staff = document.getElementById('staff').options[document.getElementById('staff').selectedIndex].text;
        const date = document.getElementById('date').value;
        const time = document.getElementById('selectedTime').value;
        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
		const nickname = document.getElementById('nickname').value; // ç²å–èœœç½æ¬„ä½çš„å€¼

		// æª¢æŸ¥èœœç½ï¼šå¦‚æœé€™å€‹éš±è—æ¬„ä½æœ‰å€¼ï¼Œå°±åˆ¤å®šç‚ºæ©Ÿå™¨äººä¸¦ä¸­æ­¢é ç´„
		if (nickname.length > 0) {
			console.warn("åµæ¸¬åˆ°æ©Ÿå™¨äººè¡Œç‚ºï¼Œå·²é˜»æ­¢æäº¤ã€‚");
			alert("æäº¤å¤±æ•—ï¼Œè«‹å‹¿é‡è¤‡æäº¤ã€‚"); 
			e.preventDefault();
			return; 
		}

        if (!time) {
            alert('è«‹é¸æ“‡é ç´„æ™‚æ®µï¼');
            return;
        }

        // --- è¨­å®šæ‚¨å‰›å‰›è¤‡è£½çš„ Google Apps Script ç¶²å€ ---
        // è«‹å°‡ä¸‹æ–¹çš„ç¶²å€æ›æˆæ‚¨è‡ªå·±çš„ Web App URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzHV8KLPw390a8MIgQg1YTTt-g5B_ughmXB86jajc32dcBjmkaQ0p7vQ8qA99mPtPNY/exec'; 

        // é–å®šæŒ‰éˆ•é¿å…é‡è¤‡é»æ“Š
        submitBtn.disabled = true;
        submitBtn.innerText = "é ç´„å‚³é€ä¸­...";

        // æ‰“åŒ…è³‡æ–™
        const formData = {
            service: service,
            staff: staff,
            date: date,
            time: time,
            name: name,
            phone: phone
        };

        // ç™¼é€è³‡æ–™åˆ° Google Sheet
        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(formData),
            mode: 'no-cors', // é‡è¦ï¼šè·¨ç¶²åŸŸè¨­å®š
            headers: {
                'Content-Type': 'text/plain'
            }
        })
        .then(() => {
            // æˆåŠŸå¾Œçš„å‹•ä½œ
            alert(`âœ… é ç´„æˆåŠŸï¼\n\næ„Ÿè¬ ${name} çš„é ç´„\næˆ‘å€‘å·²å°‡è³‡è¨Šå‚³é€è‡³ç³»çµ±ã€‚`);
            // é‡ç½®è¡¨å–®
            document.getElementById('bookingForm').reset();
            document.getElementById('timeSlotsContainer').innerHTML = '<div style="grid-column: 1/-1; color: #888; text-align: center;">è«‹å…ˆé¸æ“‡æ—¥æœŸ</div>';
            document.getElementById('serviceDetail').style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.innerText = "ç¢ºèªé ç´„";
        })
        .catch(error => {
            console.error('Error!', error.message);
            alert('âŒ ç³»çµ±å¿™ç¢Œä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ï¼Œæˆ–ç›´æ¥è¯ç¹«æˆ‘å€‘ã€‚');
            submitBtn.disabled = false;
            submitBtn.innerText = "ç¢ºèªé ç´„";
        });
    });
</script>

</body>
</html>
